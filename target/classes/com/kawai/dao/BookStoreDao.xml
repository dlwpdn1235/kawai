<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!-- bookimg -->
  <!-- bookimg   bookstore 만들고 다시 test readall은 됬음 
  		임시로 user_id default값 '김도연'으로 설정후, 테스트 아래 sql에 user_id 임시로 빼
  -->
  
   <mapper namespace="com.kawai.dao.BookStoreDao">
     <insert id="bookstoreinsert" parameterType="BookStoreVO">
	    INSERT INTO bookstore (
	        bs_name, bs_phonenum, bs_address, bs_address_detail, bs_postnum,
	        bs_closeday, bs_content, bs_opendate, bs_start_time, bs_end_time , bfile
	    )
	    VALUES (
	        #{bs_name}, #{bs_phonenum}, #{bs_address}, #{bs_address_detail}, #{bs_postnum},
	        #{bs_closeday}, #{bs_content}, #{bs_opendate}, #{bs_start_time}, #{bs_end_time} , #{bfile}
	    )
	</insert>
     
  	<update id="bookstoreupdate" parameterType="BookStoreVO">
  	UPDATE bookstore
    SET tag_id = (SELECT tag_id FROM hashtag WHERE tag_id = #{tag_id}),
        bs_start_date = #{bs_start_date},
        bs_end_date = #{bs_end_date},
        bs_closeday = #{bs_closeday},
        bs_phonenum = #{bs_phonenum},
        bs_opendate = #{bs_opendate},
        bs_content = #{bs_content},
        bs_reg_date = #{bs_reg_date}
    WHERE bs_no = #{bs_no}
  	</update> 
  	
  	<delete id="bookstoredelete" parameterType="int">
  		delete from bookstore where bs_no = #{bs_no}
  	</delete>
  	 
  	
  	<select id="bookstoreread" parameterType="int" resultType="BookStoreVO">
  		select * from bookstore where bs_no=#{bs_no}
  	</select>
  
  	<select id="bookstorereadAll" resultType="BookStoreVO">
  		select * from bookstore order by bs_no desc
  	</select> 
  	<select id="findMaxBsNo"  resultType="int">
  	 SELECT MAX(bs_no) FROM bookstore
  	</select>
  	
  	<insert id="addBookTagBox" parameterType="BookTagBoxVO">
    INSERT INTO tag_box (bs_no, tag_id)
    VALUES (#{bs_no}, #{tag_id})
	</insert>
	
	<select id="getBookStoreTagNames" resultType="java.lang.String">
        SELECT tag_name
        FROM tag_box tb
        JOIN hashtag h ON tb.tag_id = h.tag_id
    	WHERE tb.bs_no = #{bsNo}
    </select>
     <select id="getBsName" resultType="BookStoreVO">
        SELECT * FROM bookstore WHERE bs_name = #{bs_name}
    </select>

    <insert id="registerBookStore" parameterType="BookStoreVO">
        <selectKey keyProperty="bs_no" resultType="int" order="BEFORE">
            SELECT MAX(bs_no) + 1 FROM bookstore
        </selectKey>
        INSERT INTO bookstore (
            bs_name, bs_phonenum, bs_address, bs_address_detail, bs_postnum,
            bs_closeday, bs_content, bs_opendate, bs_start_time, bs_end_time
        )
        VALUES (
            #{bs_name}, #{bs_phonenum}, #{bs_address}, #{bs_address_detail}, #{bs_postnum},
            #{bs_closeday}, #{bs_content}, #{bs_opendate}, #{bs_start_time}, #{bs_end_time}
        )
    </insert>
    
    
  	
  </mapper>