<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kawai.dao.MarketCartDao">

	<insert id="marketCartInsert" parameterType="MarketCart">
		insert into mcart (market_id,user_id) values(#{market_id},#{user_id})
	</insert>

	<select id="marketCartList" parameterType="MarketCart" resultType="MarketCart">
	SELECT c.*, b.*, u.*
	FROM mCart c
	LEFT JOIN market m ON c.mcart_id = m.market_id
	LEFT JOIN bookinfo b ON b.bookinfo_id = m.market_id
	LEFT JOIN user u ON u.id = m.market_id;
	</select>
	
	<update id="marketCartUpdate" parameterType="MarketCart">
		update mcart set  user_id=#{user_id} , market_id=#{market_id} , mCartDate = now()  
		where mcart_id = market_id
	</update>
 <!-- 	<select id="marketCartInsertList" parameterType="MarketCart"> 
 		select  
 	</select>  -->
 	<delete id="marketCartDelete" parameterType="marketCart">
 		delete from mcart where mCart_id = #{no} 
 	</delete>
 	
 	<update id="marketCartCountUpdate">
		UPDATE mcart
		SET mcount = (
		  SELECT COUNT(*) FROM mcart WHERE user_id = #{user_id} AND market_id = #{market_id}
		)
		WHERE user_id = #{user_id} AND market_id = #{market_id}
 	</update>

</mapper>